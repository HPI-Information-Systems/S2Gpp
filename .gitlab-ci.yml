image: "sopedu:5000/rust:latest"

default:
  before_script:
    - rustc --version
    - cargo --version
    - sed -i "s/ssh:\/\/git/https:\/\/gitlab-ci-token:$CI_JOB_TOKEN/" Cargo.toml
    - apt-get update
    - apt-get install -y gfortran
    - apt-get install -y build-essential

stages:
  - test

testing:
  stage: test
  tags:
    - akita
  script:
    - cargo install cargo-tarpaulin
    - RUST_LOG=warn cargo tarpaulin --ignore-tests --out Xml --output-dir .
  artifacts:
    reports:
      cobertura: cobertura.xml

linting:
  stage: test
  tags:
    - akita
  script:
    - rustup component add clippy
    - cargo clippy

formatting:
  stage: test
  tags:
    - akita
  script:
    - rustup component add rustfmt
    - cargo fmt -- --check

#auditing:
#  stage: test
#  tags:
#    - akita
#  script:
#    - cargo install cargo-audit
#    - cargo audit
